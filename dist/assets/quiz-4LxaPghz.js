const g="https://klassconnect-backend.onrender.com";document.addEventListener("DOMContentLoaded",function(){const m=document.getElementById("uploadForm"),a=document.getElementById("quizSection"),w=document.getElementById("quizForm"),f=document.getElementById("submitQuiz"),p=document.getElementById("loadingSpinner"),y=document.getElementById("resultsSection"),q=document.getElementById("retakeQuiz");console.log("Using BACKEND_URL:",g);let h=[];m.addEventListener("submit",function(t){t.preventDefault(),p.style.display="flex";const n=new FormData(m);fetch(`${g}/upload`,{method:"POST",body:n}).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{if(p.style.display="none",e.error){alert("Error: "+e.error);return}h=e.mcqs,C(h),a.style.display="block",a.scrollIntoView({behavior:"smooth"})}).catch(e=>{p.style.display="none",alert("Error: "+e.message)})});function C(t){w.innerHTML="",t.forEach((n,e)=>{const s=document.createElement("div");s.className="quiz-question";const o=document.createElement("label");o.textContent=`${e+1}. ${n.question}`,s.appendChild(o);const u=document.createElement("div");u.className="quiz-options",n.options.forEach((i,d)=>{const E=document.createElement("div");E.className="option-item";const l=document.createElement("div");l.style.display="flex",l.style.alignItems="center",l.style.width="100%";const r=document.createElement("input");r.type="radio",r.name=`question-${e}`,r.value=i,r.id=`q${e}-opt${d}`,r.setAttribute("data-question",n.question),r.style.marginRight="10px";const c=document.createElement("label");c.textContent=i,c.htmlFor=`q${e}-opt${d}`,c.style.flex="1",c.style.margin="0",c.style.cursor="pointer",l.appendChild(r),l.appendChild(c),E.appendChild(l),u.appendChild(E)}),s.appendChild(u),w.appendChild(s)})}f.addEventListener("click",function(){const t=[];h.forEach((e,s)=>{const o=document.querySelector(`input[name="question-${s}"]:checked`);t.push({question:e.question,selectedAnswer:o?o.value:null})});const n=t.filter(e=>e.selectedAnswer===null).length;n>0&&!confirm(`You have ${n} unanswered question(s). Do you want to submit anyway?`)||fetch(`${g}/submit_quiz`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({answers:t})}).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{if(e.error){alert("Error: "+e.error);return}b(e),a.style.display="none",y.style.display="block",y.scrollIntoView({behavior:"smooth"})}).catch(e=>{alert("Error submitting quiz: "+e.message)})});function b(t){const n=t.score,e=t.result.length;document.getElementById("userScore").textContent=n,document.getElementById("totalQuestions").textContent=e;const s=document.getElementById("resultDetails");s.innerHTML="",t.result.forEach((o,u)=>{const i=document.createElement("div");i.className=`result-item ${o.isCorrect?"correct":"incorrect"}`;const d=`
        <h3>Question ${u+1}</h3>
        <p><strong>Question:</strong> ${o.question}</p>
        <p><strong>Your Answer:</strong> ${o.userAnswer||"Not answered"}</p>
        <p><strong>Correct Answer:</strong> ${o.correctAnswer}</p>
      `;i.innerHTML=d,s.appendChild(i)})}q.addEventListener("click",function(){m.reset(),y.style.display="none",a.style.display="none",window.scrollTo({top:0,behavior:"smooth"})})});
